/*!
 * knockout-router v0.3.0 http://alexbihary.github.com/knockout-router
 * Copyright 2014 Alexander Bihary
 * Licensed under MIT (https://github.com/alexbihary/knockout-router/blob/master/LICENSE)
 */
!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.router={})}(function(a,b){function c(b,c){"string"==typeof b&&(b={route:b}),this.config=b,this.element=c,this.isActive=a.observable(!1),e(this.config)}function d(a,b){for(var c,d,e={},f=0;null!==(c=z.exec(b));)d=c[1],B.test(d)&&a[f]&&(e[d]=a[f]),f++;if(a[f]&&A.test(a[f])){var g=a[f].split("&");g.forEach(function(a){var b=a.split("=");b[1]&&(e[b[0]]=b[1])})}return e}function e(a){a.title=a.title||f(a.route),a.module=a.module,a.hash=a.hash||g(a.route),a.href=a.href||h(a.route),a.name=a.name||i(a.route),a.routePattern=m(a.route),a.callback=k(a.callback,"function")&&a.callback||r}function f(a){var b=j(a);return b.substring(0,1).toUpperCase()+b.substring(1)}function g(a){return 0===a.indexOf(s().hashPrefix)?a:s().hashPrefix+a}function h(a){return s().root+a}function i(a){var b=j(a);return b.replace(/\//g,"-")}function j(a){var b=a.indexOf(":"),c=b>0?b-1:a.length;return a.substring(0,c)}function k(a,b){if("undefined"==typeof a)return"undefined"===b.toLowerCase();var c=new RegExp("\\[object "+b+"\\]","i");return c.test(Object.prototype.toString.call(a))}function l(){p.push(new c(t)),a.utils.arrayForEach(p(),function(c){a.history.route(c.config.routePattern,function(a){var d=n(c.config.routePattern,a);c.activate(d,a),b.vm.activeRoute(c),c.config.callback&&c.config.callback.apply(c,d),s().notify&&s().notify.apply(c,d),s().debug&&(console.group("knockout-router: navigated"),console.debug('route: "%s" (%s)',c.config.route,c.config.name),console.debug('fragment: "%s"',a),console.debug("args: ",d),console.debug("instance: %O",c),console.groupEnd())},c.config.name,!0)})}function m(a){return a=a.replace(y,"\\$&").replace(v,"(?:$1)?").replace(w,function(a,b){return b?a:"([^/?]+)"}).replace(x,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")}function n(b,c){var d=b.exec(c).slice(1);return a.utils.arrayMap(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}function o(){C(document,"click",function(a){var c=a.target||a.srcElement;if(c&&"A"===c.nodeName&&!c.getAttribute("data-bypass")){var d=c.getAttribute("href"),e=c.protocol+"//";d&&d.slice(0,e.length)!==e&&0!==d.indexOf("javascript:")&&(a.preventDefault(),d=u().test(d)?d.replace(u(),"/"):d,b.navigate(d,!0))}},!1)}var p=a.observableArray([]),q=a.observableArray([]),r=function(){},s=a.observable({debug:!1,handleRelativeAnchors:!0,hashPrefix:"#",notify:r,root:"/"}),t={route:"*notfound",name:"notfound",callback:r,nav:!1},u=a.computed(function(){return new RegExp("^"+s().root.replace(/\//g,"\\/"))}),v=/\((.*?)\)/g,w=/(\(\?)?:\w+/g,x=/\*\w+/g,y=/[\-{}\[\]+?.,\\\^$|#\s]/g,z=/:(\w+)/g,A=/^([a-zA-Z_$][0-9a-zA-Z_$]*=[^&]*&?)+$/,B=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/;console.debug||(console.debug=console.log),console.group||(console.group=console.groupEnd=console.log),c.prototype.activate=function(b,c){return this.element&&(this.element.style.display=""),this.subscribers&&a.utils.arrayForEach(this.subscribers(),function(a){a.element.style.display=""}),this.isActive(!0),this.args=b,this.data=d(b,this.config.route),this.fragment=c,this},c.prototype.deactivate=function(){return this.element&&(this.element.style.display="none"),this.subscribers&&a.utils.arrayForEach(this.subscribers(),function(a){a.element.style.display="none"}),this.isActive(!1),this},c.prototype.subscribe=function(b,c){this.subscribers=this.subscribers||a.observableArray([]),this.subscribers.push({config:b,element:c})};var C=function(){var a=function(a,b,c){for(var d=0,e=a.length;e>d;d++)C(a[d],b,c)};return document.addEventListener?function(b,c,d){b&&b.nodeName||b===window?b.addEventListener(c,d,!1):b&&b.length&&a(b,c,d)}:function(b,c,d){b&&b.nodeName||b===window?b.attachEvent("on"+c,function(){return d.call(b,window.event)}):b&&b.length&&a(b,c,d)}}();b.configure=function(c){return s(a.utils.extend(s(),c||{})),b},b.init=function(c){return s(a.utils.extend(s(),c||{})),l(),s().debug&&(console.group("knockout-router: started"),console.debug("settings: %O",s()),console.debug("debug mode: enabled"),console.groupEnd(),window.ko=window.ko||a,window.vm=window.vm||b.vm),a.history.start(s()),s().handleRelativeAnchors&&o(),b},b.vm={settings:s,navRoutes:a.computed(function(){return a.utils.arrayFilter(p(),function(a){return a.config.nav})}),routes:p,activeRoute:a.observable(),isNavigating:a.observable(!1)},b.vm.activeRoute.subscribe(function(b){b&&(a.utils.arrayForEach(q(),function(a){a&&a!==b&&q.remove(a.deactivate())}),q.push(b))}),b.map=function(a){return k(a,"array")&&a.forEach(function(a){p.push(new c(a))}),b},b.mapNotFound=function(c){return a.utils.extend(t,c||{}),b},b.navigate=function(c,d){return a.history.navigate(c,d),b},a.bindingHandlers.router={init:function(){return{controlsDescendantBindings:!0}},update:function(c,d,e,f){{var g,h,i=b.vm.activeRoute();a.utils.unwrapObservable(d())}a.virtualElements.emptyNode(c),i&&(i.config.module?g={module:{name:i.config.module,template:i.config.template||i.config.module,data:i.args}}:i.config.template&&(g={template:{name:i.config.template,data:i.data}}),g&&(h=document.createElement("ko"),c.appendChild(h),a.applyBindingsToNode(h,g,f)))}},a.bindingHandlers.route={init:function(b,d){var e,f,g=a.utils.unwrapObservable(d());k(g,"string")&&(g={route:g}),f=g.route||g.name,e=a.utils.arrayFirst(p(),function(a){return a.config.name===f||a.config.route===f||a.config.routePattern===m(f)}),e?e.subscribe(g,b):p.push(new c(g,b))}},a.virtualElements&&(a.virtualElements.allowedBindings.router=!0,a.virtualElements.allowedBindings.route=!0),a.router=b});