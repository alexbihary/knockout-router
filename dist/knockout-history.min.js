/*!
 * knockout-router v0.3.0 http://alexbihary.github.com/knockout-router
 * Copyright 2014 Alexander Bihary
 * Licensed under MIT (https://github.com/alexbihary/knockout-router/blob/master/LICENSE)
 */
!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.history={})}(function(a,b){var c=/^[#\/]|\s+$/g,d=/^\/+|\/+$/g,e=/\/$/,f=/#.*$/,g={location:window.location,history:window.history,interval:50,historyStarted:!1,options:{root:"/"},root:"/",wantsHashChange:!1,hasHashChange:!1,wantsPushState:!1,hasPushState:!1,handlers:[]};b.getEnv=function(){return a.utils.extend({},g)},b.atRoot=function(){return g.location.pathname.replace(/[^\/]$/,"$&/")===g.root},b.getHash=function(a){var b=(a||g).location.href.match(/#(.*)$/);return b?b[1]:""},b.getFragment=function(a,d){if(null==a)if(g.hasPushState||!g.wantsHashChange||d){a=decodeURI(g.location.pathname+g.location.search);var f=g.root.replace(e,"");a.indexOf(f)||(a=a.slice(f.length))}else a=b.getHash();return a.replace(c,"")},b.start=function(e){if(g.historyStarted)throw new Error("knockout-history has already been started");g.historyStarted=!0,a.utils.extend(g.options,e),g.root=g.options.root,g.wantsHashChange=g.options.hashChange!==!1,g.hasHashChange="onhashchange"in window,g.wantsPushState=!!g.options.pushState,g.hasPushState=!!(g.options.pushState&&g.history&&g.history.pushState);var f=b.getFragment(),h=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};if(g.root=("/"+g.root+"/").replace(d,"/"),!(g.hasHashChange||!g.wantsHashChange||g.wantsPushState&&g.hasPushState)){var i=document.createElement("iframe");i.src="javascript:0",i.style.display="none",i.tabIndex=-1;var j=document.body;g.iframe=j.insertBefore(i,j.firstChild).contentWindow,b.navigate(f)}if(g.hasPushState?h("popstate",b.checkUrl,!1):g.wantsHashChange&&g.hasHashChange&&!g.iframe?h("hashchange",b.checkUrl,!1):g.wantsHashChange&&(b._checkUrlInterval=setInterval(b.checkUrl,g.interval)),g.fragment=f,g.wantsHashChange&&g.wantsPushState){if(!g.hasPushState&&!b.atRoot())return g.fragment=b.getFragment(null,!0),g.location.replace(g.root+"#"+g.fragment),!0;g.hasPushState&&b.atRoot()&&g.location.hash&&(g.fragment=b.getHash().replace(c,""),g.history.replaceState({},document.title,g.root+g.fragment))}return g.options.silent?void 0:b.loadUrl()},b.stop=function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};g.hasPushState?a("popstate",b.checkUrl,!1):g.wantsHashChange&&g.hasHashChange&&g.iframe&&a("hashchange",b.checkUrl,!1),b._checkUrlInterval&&clearInterval(b._checkUrlInterval),g.historyStarted=!1},b.route=function(a,b,c,d){g.handlers[d?"push":"unshift"]({route:a,callback:b,name:c})},b.checkUrl=function(){var a=b.getFragment();return a===g.fragment&&g.iframe&&(a=b.getFragment(b.getHash(g.iframe))),a===g.fragment?!1:(g.iframe&&b.navigate(a),void b.loadUrl())},b.loadUrl=function(c){return c=g.fragment=b.getFragment(c),a.utils.arrayFirst(g.handlers,function(a){return a.route.test(c)?(a.callback(c),!0):void 0})},b.navigate=function(a,c){if(!g.historyStarted)return!1;c&&c!==!0||(c={trigger:!!c});var d=g.root+(a=b.getFragment(a||""));if(a=a.replace(f,""),g.fragment!==a){if(g.fragment=a,""===a&&"/"!==d&&(d=d.slice(0,-1)),g.hasPushState)g.history[c.replace?"replaceState":"pushState"]({},document.title,d);else{if(!g.wantsHashChange)return g.location.assign(d);b.updateHash(g.location,a,c.replace),g.iframe&&a!==b.getFragment(b.getHash(g.iframe))&&(c.replace||g.iframe.document.open().close(),b.updateHash(g.iframe.location,a,c.replace))}return c.trigger?b.loadUrl(a):void 0}},b.updateHash=function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b},a.history=b});